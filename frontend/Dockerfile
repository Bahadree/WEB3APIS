FROM node:20.19.0-alpine

WORKDIR /app

# --- Ortam değişkenleri ---
ARG NEXT_PUBLIC_API_URL
ENV NEXT_PUBLIC_API_URL=$NEXT_PUBLIC_API_URL

# Geliştirme için diğer örnek ortam değişkenleri (isteğe bağlı, Railway'den de inject edilir)
ARG NEXT_PUBLIC_APP_URL
ENV NEXT_PUBLIC_APP_URL=$NEXT_PUBLIC_APP_URL
ARG NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID
ENV NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID=$NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID
ARG NEXT_PUBLIC_ALCHEMY_API_KEY
ENV NEXT_PUBLIC_ALCHEMY_API_KEY=$NEXT_PUBLIC_ALCHEMY_API_KEY
ARG NEXT_PUBLIC_INFURA_PROJECT_ID
ENV NEXT_PUBLIC_INFURA_PROJECT_ID=$NEXT_PUBLIC_INFURA_PROJECT_ID
ARG NEXT_PUBLIC_GOOGLE_CLIENT_ID
ENV NEXT_PUBLIC_GOOGLE_CLIENT_ID=$NEXT_PUBLIC_GOOGLE_CLIENT_ID
ARG NEXT_PUBLIC_APPLE_CLIENT_ID
ENV NEXT_PUBLIC_APPLE_CLIENT_ID=$NEXT_PUBLIC_APPLE_CLIENT_ID
ARG NEXT_PUBLIC_ENABLE_WEB3
ENV NEXT_PUBLIC_ENABLE_WEB3=$NEXT_PUBLIC_ENABLE_WEB3
ARG NEXT_PUBLIC_ENABLE_NFT_MARKETPLACE
ENV NEXT_PUBLIC_ENABLE_NFT_MARKETPLACE=$NEXT_PUBLIC_ENABLE_NFT_MARKETPLACE
ARG NEXT_PUBLIC_ENABLE_P2P_GAMING
ENV NEXT_PUBLIC_ENABLE_P2P_GAMING=$NEXT_PUBLIC_ENABLE_P2P_GAMING
ARG NEXT_PUBLIC_GA_MEASUREMENT_ID
ENV NEXT_PUBLIC_GA_MEASUREMENT_ID=$NEXT_PUBLIC_GA_MEASUREMENT_ID
ARG NEXT_PUBLIC_MIXPANEL_TOKEN
ENV NEXT_PUBLIC_MIXPANEL_TOKEN=$NEXT_PUBLIC_MIXPANEL_TOKEN

# Gerekli araçlar
RUN apk add --no-cache git

# Paket dosyalarını kopyala
COPY package*.json ./

# Npm cache temizle ve bağımlılıkları yükle
RUN npm cache clean --force
RUN npm install --frozen-lockfile || npm install

# Kaynak kodunu kopyala
COPY . .

# Uygulamayı build et
RUN npm run build

# Portu aç
EXPOSE 3000

# Uygulamayı başlat
CMD ["npm", "start"]
